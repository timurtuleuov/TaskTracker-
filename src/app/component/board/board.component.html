<mat-drawer-container class=" dark:bg-gray-900 dark:text-white">
  <mat-drawer
  #drawer
  class="dark:bg-gray-800 dark:text-white p-4 flex flex-col items-center justify-center h-full"
  mode="side"
>
  <ul class="space-y-6 w-full max-w-xs">
    <!-- –≠–∫—Å–ø–æ—Ä—Ç -->
    <li class="flex justify-center">
      <button mat-raised-button color="primary" class="w-full" (click)="exportLocalStorage()">
        –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å
      </button>
    </li>

    <!-- –ò–º–ø–æ—Ä—Ç -->
    <li class="flex justify-center">
      <label
        for="file-upload"
        class="cursor-pointer text-center text-white bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded-md text-sm w-full"
      >
        –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å localStorage
      </label>
      <input
        type="file"
        id="file-upload"
        class="hidden"
        accept=".json"
        (change)="importLocalStorage($event)"
      />
    </li>

    <!-- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ -->
    <li class="flex flex-col items-center">
      <p class="text-lg font-semibold mb-2 text-center">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</p>
      <mat-form-field appearance="fill" class="w-full">
        <mat-label>–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä</mat-label>
        <mat-select [(ngModel)]="selectedSort" (selectionChange)="onSortChange($event.value)">
          @for (sort of sorts; track sort) {
            <mat-option [value]="sort">{{ sort }}</mat-option>
          }
        </mat-select>
      </mat-form-field>
    </li>
  </ul>
</mat-drawer>

  
<div class="dark:bg-gray-900 dark:text-white w-full">



  <div class="container px-4 max-w-screen-lg lg:max-w-screen-2xl sm:max-w-screen-2xl dark:bg-gray-900 dark:text-white">
    

      
    
  <!-- –í—ã–±–æ—Ä –¥–æ—Å–∫–∏ -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 items-center gap-4 p-4 dark:bg-gray-900 dark:text-white">
    <!-- –ü—É—Å—Ç–æ–π –±–ª–æ–∫ –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è -->
    <div class="flex justify-center">
      <button mat-fab (click)="drawer.toggle()">
        <mat-icon>settings</mat-icon>
      </button>
    </div>

    <!-- –í—ã–±–æ—Ä –¥–æ—Å–∫–∏ -->
    <div class="flex justify-center">
      <mat-form-field  class="w-full max-w-xs dark:bg-gray-900 dark:text-white">
        <mat-label>Boards</mat-label>
        <mat-select [(value)]="selectedBoard" (selectionChange)="onBoardChange($event.value)">
          <mat-option></mat-option>
          @for (option of boards; track option) {
            <mat-option [value]="option.id">{{ option.title }}</mat-option>
          }
        </mat-select>
      </mat-form-field>
      </div>


      <!-- –í—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω -->
    <div class="flex justify-center">
    
      <mat-form-field class="w-full max-w-xs dark:bg-gray-900 dark:text-white">
        <mat-date-range-input [formGroup]="range" [rangePicker]="picker" >

          <input matStartDate  [(ngModel)]="startDate" name="start" formControlName="start" placeholder="–ù–∞—á. –¥–∞—Ç–∞" (dateChange)="onTimeRangeChange()">
          <input matEndDate [(ngModel)]="endDate" name="deadline" formControlName="end" placeholder="–ö–æ–Ω. –¥–∞—Ç–∞" (dateChange)="onTimeRangeChange()">
        </mat-date-range-input>
        <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-date-range-picker #picker></mat-date-range-picker>
      </mat-form-field>

      
    </div>
  </div>

  <!-- –ó–∞–¥–∞—á–∏ -->
  <div cdkDropListGroup class="flex flex-col  sm:flex-row justify-center gap-4 min-h-screen p-4 dark:bg-gray-900 dark:text-white">
    
    <!-- –ö–æ–ª–æ–Ω–∫–∞ To Do -->
    <div class="drag-container flex-1 max-w-xs sm:max-w-sm lg:max-w-md min-w-0">
      <div class="flex items-center justify-between mb-4">
        <p class="text-4xl leading-tight">To Do</p>
        <button (click)="addTask('todo')" mat-icon-button>
          <mat-icon>add</mat-icon>
        </button>
      </div>

    

      <div *ngIf="isDataLoaded"
      cdkDropList
      [cdkDropListData]="todo"
      class="drag-list dark:bg-gray-700 dark:text-white max-h-screen"
      (cdkDropListDropped)="drop($event)">
      @for (item of todo; track item) {
        <div class="drag-box flex flex-col p-2 task" cdkDrag [ngStyle]="getTaskStyle(item)">
          <div class="flex justify-between items-center ">
          
            <button (click)="toggleEmojiPicker(item.id)"
            class="img"
            [style.opacity]="item.emoji ? '1' : '0.1'"
            [style.fontSize.px]="24">
      {{ item.emoji || 'üòä' }}
    </button>
      <emoji-mart *ngIf="activeEmojiPickerId === item.id"
      class="emoji-mart"
      [showPreview]="false"
      [style]="{ position: 'absolute', zIndex: '1000' }"

      [darkMode]="darkMode"
      (emojiSelect)="addEmoji($event, item)"
      title="Choose your emoji"></emoji-mart>
              <span class="flex-1 max-w-[250px] min-w-[200px]overflow-hidden truncate break-words">{{ item.title }}</span>
                  <div class="flex space-x-2">
                    <button mat-icon-button (click)="editTask(item)">
                      <mat-icon>edit</mat-icon>
                    </button>
                    <button mat-icon-button [matMenuTriggerFor]="menu">
                      <mat-icon>more_horiz</mat-icon>
                    </button>
                    <mat-menu #menu="matMenu">
                      <button mat-menu-item (click)="deleteTask(item)">
                        <span>–£–¥–∞–ª–∏—Ç—å</span>
                      </button>
                      <button mat-menu-item (click)="duplicateTask(item)">
                        <span>–î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ</span>
                      </button>
                      <button mat-menu-item [routerLink]="['/task/', item.id]">
                        <span>–û—Ç–∫—Ä—ã—Ç—å</span>
                      </button>
                    </mat-menu>
                  </div>
                </div>
                  <div class="flex flex-wrap gap-2 mt-2">
                    <mat-chip-set *ngFor="let tag of item.tags">
                      <mat-chip  [style.backgroundColor]="tagColorMap[tag.title] + ' !important'" >
                        <p class="text-white m-0 drop-shadow-[0_1.4px_1.4px_rgba(0,0,0,0.8)]" > {{ tag.title }}</p>
                      </mat-chip>
                    </mat-chip-set>
    </div>
                </div>
              
      }
            </div>
      </div>


          <div class="drag-container flex-1 max-w-xs sm:max-w-sm lg:max-w-md min-w-0">
            <div class="flex items-center justify-between mb-4">
          <p class="text-4xl leading-tight">Doing</p>
              <button (click)="addTask('doing')" mat-icon-button aria-label="Example icon button with a vertical three dot icon">
                  <mat-icon>add</mat-icon>
              </button>
          </div>

          <div *ngIf="isDataLoaded"
          cdkDropList
          [cdkDropListData]="doing"
          class="drag-list dark:bg-gray-700 dark:text-white max-h-screen"
          (cdkDropListDropped)="drop($event)">
          @for (item of doing; track item) {
            <div class="drag-box flex flex-col p-2" cdkDrag [ngStyle]="getTaskStyle(item)">
              <div class="flex justify-between items-center ">
              
                <button (click)="toggleEmojiPicker(item.id)"
                class="img"
                [style.opacity]="item.emoji ? '1' : '0.1'"
                [style.fontSize.px]="24">
          {{ item.emoji || 'üòä' }}
        </button>
          <emoji-mart *ngIf="activeEmojiPickerId === item.id"
          class="emoji-mart"
          [showPreview]="false"
          [style]="{ position: 'absolute', zIndex: '1000' }"

          [darkMode]="darkMode"
          (emojiSelect)="addEmoji($event, item)"
          title="Choose your emoji"></emoji-mart>
                  <span class="flex-1 max-w-[250px] min-w-[200px]overflow-hidden truncate break-words">{{ item.title }}</span>
                      <div class="flex space-x-2">
                        <button mat-icon-button (click)="editTask(item)">
                          <mat-icon>edit</mat-icon>
                        </button>
                        <button mat-icon-button [matMenuTriggerFor]="menu">
                          <mat-icon>more_horiz</mat-icon>
                        </button>
                        <mat-menu #menu="matMenu">
                          <button mat-menu-item (click)="deleteTask(item)">
                            <span>–£–¥–∞–ª–∏—Ç—å</span>
                          </button>
                          <button mat-menu-item (click)="duplicateTask(item)">
                            <span>–î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ</span>
                          </button>
                          <button mat-menu-item [routerLink]="['/task/', item.id]">
                            <span>–û—Ç–∫—Ä—ã—Ç—å</span>
                          </button>
                        </mat-menu>
                      </div>
                    </div>
                      <div class="flex flex-wrap gap-2 mt-2">
          <mat-chip-set *ngFor="let tag of item.tags">
            <mat-chip  [style.backgroundColor]="tagColorMap[tag.title] + ' !important'" >
              <p class="text-white m-0 drop-shadow-[0_1.4px_1.4px_rgba(0,0,0,0.8)]" > {{ tag.title }}</p>
            </mat-chip>
          </mat-chip-set>
        </div>
                    </div>
                  
          }
                </div>
          </div>

          <!-- –ö–æ–ª–æ–Ω–∫–∞ Done -->
          <div class="drag-container flex-1 max-w-xs sm:max-w-sm lg:max-w-md min-w-0">
            <div class="flex items-center justify-between mb-4">
          <p class="text-4xl leading-tight">Done</p>
              <button (click)="addTask('done')" mat-icon-button>
                  <mat-icon>add</mat-icon>
              </button>
          </div>

          <div *ngIf="isDataLoaded"
          cdkDropList
          [cdkDropListData]="done"
          class="drag-list dark:bg-gray-700 dark:text-white max-h-screen"
          (cdkDropListDropped)="drop($event)">
          @for (item of done; track item) {
            <div class="drag-box flex flex-col p-2 relative" cdkDrag>
               <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è GIF -->
               <div
              class="fireworks-gif relative "
              id="fireworks-{{ item.id }}"
              [ngClass]="{ 'fire': fireworksStates[item.id] }"
            >
              <img
                src="assets/gif/fireworks.gif"
                alt="Fireworks"
                class="object-top absolute z-50"
              />
            </div>

             
              <div class="flex justify-between items-center ">
              
                <button (click)="toggleEmojiPicker(item.id)"
                class="img"
                [style.opacity]="item.emoji ? '1' : '0.1'"
                [style.fontSize.px]="24">
          {{ item.emoji || 'üòä' }}
        </button>
          <emoji-mart *ngIf="activeEmojiPickerId === item.id"
          class="emoji-mart"
          [showPreview]="false"
          [style]="{ position: 'absolute', zIndex: '1000' }"

          [darkMode]="darkMode"
          (emojiSelect)="addEmoji($event, item)"
          title="Choose your emoji"></emoji-mart>
                  <span class="flex-1 max-w-[250px] min-w-[200px]overflow-hidden truncate break-words">{{ item.title }}</span>
                      <div class="flex space-x-2">
                        <button mat-icon-button (click)="editTask(item)">
                          <mat-icon>edit</mat-icon>
                        </button>
                        <button mat-icon-button [matMenuTriggerFor]="menu">
                          <mat-icon>more_horiz</mat-icon>
                        </button>
                        <mat-menu #menu="matMenu">
                          <button mat-menu-item (click)="deleteTask(item)">
                            <span>–£–¥–∞–ª–∏—Ç—å</span>
                          </button>
                          <button mat-menu-item (click)="duplicateTask(item)">
                            <span>–î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ</span>
                          </button>
                          <button mat-menu-item [routerLink]="['/task/', item.id]">
                            <span>–û—Ç–∫—Ä—ã—Ç—å</span>
                          </button>
                        </mat-menu>
                      </div>
                    </div>
                      <div class="flex flex-wrap gap-2 mt-2">
                        <mat-chip-set *ngFor="let tag of item.tags">
                          <mat-chip  [style.backgroundColor]="tagColorMap[tag.title] + ' !important'" >
                            <p class="text-white m-0 drop-shadow-[0_1.4px_1.4px_rgba(0,0,0,0.8)]" > {{ tag.title }}</p>
                          </mat-chip>
                        </mat-chip-set>
        </div>
       
                    </div>
                    
                  
          }
                </div>

               
          </div>
      </div>
   
    </div>
    
</div>
</mat-drawer-container>